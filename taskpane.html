<!-- Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT License. -->
<!DOCTYPE html>
<html>

<head>
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.9.1.min.js" type="text/javascript"></script>
    <!-- Office JavaScript API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script> <!--This pulls the office.js addin into the frame-->
    
</head>

<body>
    <p>I like USAF</p> <!--Determines the paragraph Description in the taskpane-->
    <button id="cuiButton">CUI</button> <!--Controls Text in button-->
    <button id="piiButton">PII</button> <!--Controls Text in button-->
</body>

<script>
    Office.onReady((info) => { // this line initializes the office.js and is required before any calls to a office js app is made
        if (info.host === Office.HostType.Outlook) {
            document.getElementById("cuiButton").onclick = buildCUIMarkings;
            document.getElementById("piiButton").onclick = buildPIIMarkings;
        }
    });

    /**
     * Writes 'Hello world!' to a new message body.
     */

    function build_HTML_CUI(newheader,newsig){
        newheader = "<p><b>CUI</b></p><br>";
        newsig = "<p><b>Controlled by: <br>Controlled by: <br>CUI Category: <br>Distribution/Dissemination Controls: <br>POC: </p><br><p>CUI</p></b>";
    }

    function build_Text_CUI(newheader,newsig){
        newheader = "CUI \n\n";
        console.log(newheader);
        newsig = "\n\n Controlled by: \n Controlled by: \n CUI Category: \n Distribution/Dissemination Controls: \n POC: \n\n CUI";

    }

    function addTextToBody(msgType, newheader, newsig) {

        //Debug
        console.log(msgType + " msgType was passed");

        //Get some User Data to setup new Signature
        var UserName = Office.context.mailbox.userProfile.displayName;
        var UserEmail = Office.context.mailbox.userProfile.emailAddress;

        //Setup the newSignature
        var str = "";
        str += "<table>";
        str += "<tr>";
        str += "<td style='padding-left: 5px;'>";
        str += "//SIGNED//<br/>";
        str += "<strong>" + UserName + "</strong>";
        str += "<br/>";
        str += "Title: <br/>";
        str += "Email: " + UserEmail + "<br/>";
        str += "Phone: <br/>";
        str += "</td>";
        str += "</tr>";
        str += "</table>";
        
        
        //Create new Signature for User
        var htmlSigHeader = str;
        var textSigHeader = "\n //Signed// \n " + UserName + " \n Email: " + UserEmail;
        
        
        if (msgType === Office.MailboxEnums.BodyType.Html) {
            newsig = htmlSigHeader + newsig;
            msgType = "html";
        }
        else {
            newsig = textSigHeader + newsig;
            msgType = "text"
        };

        //Debug
        console.log("This is right before setSignatureAsync is called");

        //SET SIGNATURE or Footer
        try {
            Office.context.mailbox.item.body.setSignatureAsync(
                newsig,
                {
                    coercionType: msgType,
                    asyncContext: "setSignature"
                },
                //Debug
                setCallback
            );
            
            //SET Header
            Office.context.mailbox.item.body.prependAsync(
                newheader,
                {
                    coercionType: msgType,
                    asyncContext: "prepend Body"
                },
                //Debug
                setCallback
            );
        }
        catch (err) {
            //If setSignatureAsync is not supported change the body of the message
            //or just add everything to the top and have user copy & paste

            console.log(err.message);
        
            //Set Body of Message instead of Header and Footer
            Office.context.mailbox.item.body.getAsync(
                msgType,
                function (oldBody) {
                    Office.context.mailbox.item.body.setAsync(
                        newheader + oldBody.value + newsig,
                        {
                            coercionType: msgType,
                            asyncContext: "Body"
                        },
                        //Debug
                        setCallback
                    )
                }
            );
        };
    };



    function buildCUIMarkings() { // this function is attached to the hello world button in the taskpane
        Office.context.mailbox.item.body.getTypeAsync(
        function (result) {
            if (result.status === Office.AsyncResultStatus.Succeeded) {
                var dataValue = result.value; // Get selected data.
                console.log('Selected data is ' + dataValue);
                let newheader;
                let newsig;
                if (result.value == Office.MailboxEnums.BodyType.Html) {
                    newheader = "<p><b>CUI</b></p><br>";
                    newsig = "<p><b>Controlled by: <br>Controlled by: <br>CUI Category: <br>Distribution/Dissemination Controls: <br>POC: </p><br><p>CUI</p></b>";
    
                }
                else{
                    build_Text_CUI(newheader,newsig)
                    console.log(newheader);
                }
                addTextToBody(result.value, newheader, newsig);
            } else {
                console.log(result.error);
            }
        });

        addTextToSubject();
            
            
       /* 
        Office.context.mailbox.item.body.setAsync( //adds hello world to email
            "This should build CUI markings",
            {
                coercionType: "html", // Write text as HTML
            },

            // Callback method to check that setAsync succeeded
            function (asyncResult) {
                if (asyncResult.status ==
                    Office.AsyncResultStatus.Failed) {
                    write(asyncResult.error.message);
                }
            }
        );
        */
    }

    // Gets the subject of the item and adds (U) in front of it.
    function addTextToSubject() {
        //var subject = Office.context.mailbox.item.subject;

        Office.context.mailbox.item.subject.getAsync(
            function (asyncResult) {
                //Debug
                console.log(asyncResult.value + " Subject was found");
                //Set the Subject
                Office.context.mailbox.item.subject.setAsync(
                    "(U) " + asyncResult.value,
                    { asyncContext: "Subject"},
                    //Debug
                    setCallback
                );
            }
        );
        //Calls addInternetHeader Function Next
        addInternetHeader();
        
    };

    function addInternetHeader() {
        try{
            Office.context.mailbox.item.internetHeaders.setAsync(
            { "x-preferred-fruit": "orange"},
            setCallback
            );
            //Calls killEvent Next
            killCUI();
        }
        catch (err) {
            console.log("Internet Header =" + err.message);
            //Calls killEvent Next
            killCUI();
        }

    };

    function killCUI(){
        console.log("Finished Marking Command");
    };



    function buildPIIMarkings() { // this function is attached to the hello world button in the taskpane
        Office.context.mailbox.item.body.setAsync( //adds hello world to email
            "This should build PII markings",
            {
                coercionType: "html", // Write text as HTML
            },

            // Callback method to check that setAsync succeeded
            function (asyncResult) {
                if (asyncResult.status ==
                    Office.AsyncResultStatus.Failed) {
                    write(asyncResult.error.message);
                }
            }
        );
    }

    //Debug Success/Error Handler
    function setCallback() {
        if (asyncResult.status === Office.AsyncResultStatus.Succeeded) {
        console.log("Successfully set Async on " + asyncResult.asyncContext);
        } else {
        console.log("Error setting " + asyncResult.asyncContext + ": " + JSON.stringify(asyncResult.error));
        }
    };

</script>

</html>